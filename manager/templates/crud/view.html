{% extends 'base.html' %}

{% block page_title %}{{ record.title }}{% endblock %}

{% block sidebar %}
<h2 class="subtitle">Actions</h2>
{% if user.is_authenticated %}
<div class="buttons are-small has-addons">
    <a href="{{ url_for('manager.handle_record', id=record.id) }}?edit=true" class="button" role="button">Edit</a>
</div>
<h2 class="subtitle">Index to Solr</h2>
<div class="field is-grouped is-grouped-vertical">
    <div class="control">
        <button class="button is-info is-small"
                hx-post="{{ url_for('manager.handle_solr', id=record.id) }}?env=dev"
                hx-trigger="click"
                hx-target="#reindex-result"
                hx-swap="innerHTML"
                title="Index to dev core ({{ solr.core_dev }})">
            Index — Dev
        </button>
    </div>
    {% if user.name == "admin" %}
    <div class="control">
        <button class="button is-warning is-small"
                hx-post="{{ url_for('manager.handle_solr', id=record.id) }}?env=prod"
                hx-trigger="click"
                hx-target="#reindex-result"
                hx-swap="innerHTML"
                title="Index to production core ({{ solr.core_prod }}) - Admin only">
            Index — Production
        </button>
    </div>
    {% else %}
    <div class="control">
        <button class="button is-warning is-small" disabled title="Only admin users can index to production">
            Index — Production (admin only)
        </button>
    </div>
    {% endif %}
</div>
{% else %}
<p><em>You are not logged in.</em></p>
{% endif %}
<h2 class="subtitle">View record as...</h2>
<div class="buttons are-small has-addons">
    <a href="{{ url_for('manager.handle_record', id=record.id) }}?f=json" class="button">JSON</a>
    <a href="{{ url_for('manager.handle_record', id=record.id) }}?f=solr" class="button">Solr</a>
</div>
<h2 class="subtitle">View record in...</h2>
<div class="buttons are-small has-addons">
    <a href="{{ gbl_host }}/catalog/{{ record.id }}" class="button" role="button" target="_blank">GeoBlacklight</a>
    <a href="{{ discovery_app_url }}/search/?show={{ record.id }}" class="button" role="button" target="_blank">Data Discovery App</a>
</div>
<div id="reindex-result"></div>
<h2 class="subtitle">Jump to</h2>
<div class="content" style="height:100%">
    <ul style="font-size:.8em; list-style:none; margin-left:0">
        {% for link in link_list %}
        <li><a href="/record/{{link.id}}">{{link.title}}</a></li>
        {% endfor %}
    </ul>
</div>
{% endblock %}

{% block main_content %}
<div class="tabs is-toggle is-small">
    <ul>
        {% for group in display_groups %}
        <li><a href="#{{ group['name'] }}">{{ group['name'] }}</a></li>
        {% endfor %}
    </ul>
</div>
<div class="record-content">
    {% for group in display_groups %}
    <section>
        <h2 id="{{ group['name'] }}" class="subtitle">{{ group['name'] }}</h2>
        <table class="table table-striped is-fullwidth">
            <tbody style="overflow-x:auto;">
                {% for field in group['fields'] %}
                <tr class="display-group">
                    <td scope="row" style="width:250px;">
                        <span class="{{ field.obligation }} form-label">
                            {{ field.label }}
                            {% if field.multiple %}+{% endif %}
                        </span>
                        {% if field.schema == 'Aardvark' %}
                            <a href="https://opengeometadata.org/ogm-aardvark/#{{ field.slug }}" target="_blank">&nearr;</a>
                        {% endif %}
                    </td>
                    <td>
                    {% if field['id'] == "keyword" and record[field['id']] %}
                        {% for keyword in record[field['id']] %}
                        <span class="tag">{{ keyword }}</span>
                        {% endfor %}
                    {% else %}
                        {% if field['data_type'] != "boolean" and record[field['id']] and record[field['id']]|length > 100 %}
                        <details>
                            <summary>show full (this value is very long)</summary>
                            {{ record[field['id']] }}
                        </details>
                        {% else %}
                        {{ record[field['id']] }}
                        {% endif %}
                    {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
    {% endfor %}
</div>
{% endblock %}
