{% extends 'base.html' %}

{% block page_title %}SDOH Place Metadata Records{% endblock %}

{% block sidebar %}
{% if user.is_authenticated %}
<h2 class="subtitle">Actions</h2>
<div class="buttons are-small">
    <a href="{{ url_for('manager.create_record')}}" class="button">Create New Record</a>
    <form style="width:100%" action="{{ url_for('manager.handle_solr', id='reindex-all') }}" method="post">
        <button class="button" style="width:100%"  name="index-btn" value="index" title="Clean and recreate the entire Solr index from current records">Refresh Solr Index</button>
    </form>
</div>
{% endif %}
{% endblock %}

{% block main_content %}
<table class="table table-striped is-fullwidth">
    <thead>
        <tr>
            <td>Title</td>
            <td>Last Edit</td>
            <td>Completess</td>
            <td></td>
        </tr>
    </thead>
    <tbody style="overflow-y:auto; max-height: calc(100vh - 110px);">
        {% for record in records %}
        <tr>
            <td>
                <a href="{{ url_for('manager.handle_record', id=record.id) }}">{{record['title']}}</a>
            </td>
            <td>
                <span style="font-size:.8em;">{{record['meta']['last_modified_by']}}</span>
            </td>
            <td>
                <span class="tag is-{{record['meta']['progress_class']}}">{{record['meta']['filled_pct']}}% ({{record['meta']['filled']}}/{{record['meta']['to_fill']}})</span>
            </td>
            <td style="width:40px;">
                <div class="dropdown is-hoverable">
                    <div class="dropdown-trigger">
                      <button class="button is-small" aria-haspopup="true" aria-controls="{{record.id}}-dropdown-menu">
                        <span>ï¸™</span>
                      </button>
                    </div>
                    <div class="dropdown-menu" id="{{record.id}}-dropdown-menu" role="menu">
                        <div class="buttons are-small is-left has-addons">
                            <a href="{{ url_for('manager.handle_record', id=record.id) }}?f=json" class="button is-link" data-tooltip="View this record as JSON">JSON</a>
                            <a href="{{ url_for('manager.handle_record', id=record.id) }}?f=solr" class="button is-link" data-tooltip="View this record's corresponding Solr document">Solr</a>
                            <a href="{{ gbl_host }}/catalog/{{ record.id }}" class="button is-link" role="button" target="_blank" data-tooltip="View this record in GeoBlacklight">GBL</a>
                        </div>
                    </div>
                </div>
                
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}